var Suggest=new Class({initialize:function(b,a){this.obj=b;this.options={url:"/search/auto-complete",maxResults:10};this.options=$extend(this.options,a);this.cache={};this.timer={};this.flag=false;var c=this;this.xhr=new Request({method:"post",url:c.options.url,onSuccess:function(d){c.onSuccess(d);c.onkey()}});this.div=new Element("div",{"class":"suggest",id:"suggest"+(+new Date()),html:"<ul></ul>",style:"display:none"});this.div.inject(document.body,"bottom");this.bind();this.Fx();window.addEvent("resize",this.Fx.bind(this))},bind:function(){var a=this;this.obj.addEvents({focus:function(){a.flag=true;a.start()},blur:function(){a.stop()}})},Fx:function(){var b=this.obj.getSize();var c=this.obj.getPosition();this.div.setStyles({width:b.x,left:c.x,top:c.y+b.y});var a=$("player");if(a){this.div.setStyles({height:"105px",overflow:"hidden"})}},creatHtml:function(a){var b=this;return new Element("li",{html:'<a href="#">'+a.txt+"</a>",events:{click:function(){b.obj.set("value",a.txt);b.cache.keyword=a.txt;setTimeout(function(){b.obj.focus()},10);b.obj.getParent("form").submit();return false}}})},start:function(){if(this.timer.stopTimer){clearTimeout(this.timer.stopTimer)}var a=this.obj.get("value").trim();var b=this;this.Fx();if(a!==searchKeyHint&&a!==this.cache.keyword){this.cache.keyword=a;this.xhr.cancel();this.xhr.send("q="+a+"&maxResults="+b.options.maxResults)}else{if(this.cache.responseText!=null&&a==this.cache.keyword){this.div.setStyle("display","block")}}if(this.flag){this.timer.startTimer=setTimeout(function(){b.start()},500)}},stop:function(){if(this.timer.startTimer){clearTimeout(this.timer.startTimer)}this.flag=false;var a=this;this.timer.stopTimer=setTimeout(function(){a.div.setStyle("display","none")},250)},onkey:function(){var b=-1,e=b,c=this.div.getElements("ul a"),a=c.length;c.each(function(g,f){g.addEvents({mouseover:function(h){h.stopPropagation();if(c[b]){c[b].removeClass("hover")}g.addClass("hover");b=f}})});this.div.removeEvents("mouseover");this.div.addEvent("mouseover",function(){if(c[e]){c[e].removeClass("hover")}});var d=this;this.obj.removeEvents("keydown");this.obj.addEvent("keydown",function(g){switch(g.key){case"down":clearTimeout(d.timer.startTimer);if(c[b]){c[b].removeClass("hover")}e=e<a-1?++b:0;b=e;var h=c[e].get("text");this.set("value",h);d.cache.keyword=h;if(d.flag){d.timer.startTimer=setTimeout(function(){d.start()},500)}c[e].addClass("hover");break;case"up":clearTimeout(d.timer.startTimer);if(c[b]){c[b].removeClass("hover")}e=e>0?--b:a-1;b=e;var f=c[e].get("text");this.set("value",f);d.cache.keyword=f;if(d.flag){d.timer.startTimer=setTimeout(function(){d.start()},500)}c[e].addClass("hover");break;case"enter":break;default:}})},onSuccess:function(responseText){var results=eval("("+responseText+")").videos;this.cache.responseText=results;if(results!=null){this.div.setStyle("display","block");var ul=this.div.getElement("ul");ul.innerHTML="";var player=$("player");var len=results.length;if(player){if(len>4){len=4}}for(var i=0;i<len;i++){this.creatHtml(results[i]).inject(ul,"bottom")}}else{this.div.setStyle("display","none")}}});