function fancard(fantuan,fancard_template){fantuan=fantuan||$$(".groupcover");var fancard=$("fancard");fancard_template=fancard_template||$("fancard-template");var body=$$("body")[0];var tpl=fancard_template.value;var leavetimer=0;var entertimer=0;var buffer={};fantuan.addEvents({mouseenter:function(e){var self=this;entertimer=setTimeout(function(){entertimer=0;var fid=self.get("fanid");if(!fancard){fancard=new Element("div",{id:"fancard"});body.grab(fancard);fancard.addEvents({mouseenter:function(){if(leavetimer){clearTimeout(leavetimer)}},mouseleave:function(){fancard.fade("out")}})}fancard.innerHTML=Mustache.to_html(tpl,{});var pos=$(e.target).getPosition();var size=$(e.target).getSize();var fancard_size={x:350+16,y:234};var doc_size=$(document).getSize();var doc_scroll=$(document).getScroll();var options={display:"block",left:pos.x+size.x+5,top:pos.y-2};if(options.left+fancard_size.x>doc_size.x+doc_scroll.x){options.left=pos.x-fancard_size.x-5}if(options.top+fancard_size.y>doc_size.y+doc_scroll.y){options.top=doc_size.y+doc_scroll.y-fancard_size.y-5}fancard.setStyles(options).fade("in");if(!buffer[fid]){new Request({url:"/fan/get-artist-card",data:"artistId="+fid,method:"post",onSuccess:function(data){data=eval("("+data+")");buffer[fid]=data;fancard.innerHTML=Mustache.to_html(tpl,data)}}).send()}else{fancard.innerHTML=Mustache.to_html(tpl,buffer[fid])}},200)},mouseleave:function(){if(entertimer){clearTimeout(entertimer)}else{leavetimer=setTimeout(function(){leavetimer=0;fancard.fade("out")},200)}}})};