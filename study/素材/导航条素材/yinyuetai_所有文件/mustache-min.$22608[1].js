var Mustache=function(){var b=function(){};b.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(h,i,j,g){if(!g){this.context=i;this.buffer=[]}if(!this.includes("",h)){if(g){return h}else{this.send(h);return}}h=this.render_pragmas(h);var a=this.render_section(h,i,j);if(g){return this.render_tags(a,i,j,g)}this.render_tags(a,i,j,g)},send:function(a){if(a!==""){this.buffer.push(a)}},render_pragmas:function(a){if(!this.includes("%",a)){return a}var e=this;var f=new RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag,"g");return a.replace(f,function(d,j,i){if(!e.pragmas_implemented[j]){throw ({message:"This implementation of mustache doesn't understand the '"+j+"' pragma"})}e.pragmas[j]={};if(i){var c=i.split("=");e.pragmas[j][c[0]]=c[1]}return""})},render_partial:function(a,e,f){a=this.trim(a);if(!f||f[a]===undefined){throw ({message:"unknown_partial '"+a+"'"})}if(typeof(e[a])!="object"){return this.render(f[a],e,f,true)}return this.render(f[a],e[a],f,true)},render_section:function(i,j,a){if(!this.includes("#",i)&&!this.includes("^",i)){return i}var g=this;var h=new RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg");return i.replace(h,function(f,e,l,d){var c=g.find(l,j);if(e=="^"){if(!c||g.is_array(c)&&c.length===0){return g.render(d,j,a,true)}else{return""}}else{if(e=="#"){if(g.is_array(c)){return g.map(c,function(k){return g.render(d,g.create_context(k),a,true)}).join("")}else{if(g.is_object(c)){return g.render(d,g.create_context(c),a,true)}else{if(typeof c==="function"){return c.call(j,d,function(k){return g.render(k,j,a,true)})}else{if(c){return g.render(d,j,a,true)}else{return""}}}}}}})},render_tags:function(i,t,r,p){var q=this;var m=function(){return new RegExp(q.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+q.ctag+"+","g")};var o=m();var n=function(e,d,c){switch(d){case"!":return"";case"=":q.set_delimiters(c);o=m();return"";case">":return q.render_partial(c,t,r);case"{":return q.find(c,t);default:return q.escape(q.find(c,t))}};var a=i.split("\n");for(var s=0;s<a.length;s++){a[s]=a[s].replace(o,n,this);if(!p){this.send(a[s])}}if(p){return a.join("\n")}},set_delimiters:function(d){var a=d.split(" ");this.otag=this.escape_regex(a[0]);this.ctag=this.escape_regex(a[1])},escape_regex:function(d){if(!arguments.callee.sRE){var a=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+a.join("|\\")+")","g")}return d.replace(arguments.callee.sRE,"\\$1")},find:function(h,g){h=this.trim(h);function a(c){return c===false||c===0||c}var f;if(a(g[h])){f=g[h]}else{if(a(this.context[h])){f=this.context[h]}}if(typeof f==="function"){return f.apply(g)}if(f!==undefined){return f}return""},includes:function(d,a){return a.indexOf(this.otag+d)!=-1},escape:function(a){a=String(a===null?"":a);return a.replace(/&(?!\w+;)|["'<>\\]/g,function(d){switch(d){case"&":return"&amp;";case"\\":return"\\\\";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return d}})},create_context:function(f){if(this.is_object(f)){return f}else{var e=".";if(this.pragmas["IMPLICIT-ITERATOR"]){e=this.pragmas["IMPLICIT-ITERATOR"].iterator}var a={};a[e]=f;return a}},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(g,i){if(typeof g.map=="function"){return g.map(i)}else{var h=[];var a=g.length;for(var j=0;j<a;j++){h.push(i(g[j]))}return h}}};return({name:"mustache.js",version:"0.3.1-dev",to_html:function(i,a,j,g){var h=new b();if(g){h.send=g}h.render(i,a,j);if(!g){return h.buffer.join("\n")}}})}();